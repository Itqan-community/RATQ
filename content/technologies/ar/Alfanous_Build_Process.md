# توثيق نظام البناء الخاص بـ Alfanous

**نظام البناء الخاص بـ [Alfanous](./alfanous.md)** يقوم بأتمتة عملية بناء وفهرسة وإعداد البيانات اللغوية القرآنية لمحرك البحث. يستخدم **GNU Makefile** الذي ينسق تنزيل الموارد، وبناء قاعدة البيانات، وإنشاء الفهرس، والمعالجة اللاحقة عبر نصوص Python.

---

## 1. نظرة عامة

يحدد Makefile خط أنابيب بناء عالي المستوى ينتج العمود الفقري للبيانات الخاصة بـ Alfanous.

```
المصادر القرآنية الأولية (XML، ملفات SQL)
        │
        ▼
بناء قاعدة البيانات (SQLite)
        │
        ▼
إنشاء الموارد اللغوية
        │
        ▼
بناء فهارس البحث
        │
        ▼
إنشاء قواميس التدقيق الإملائي
        │
        ▼
إنهاء الموارد الديناميكية والبيانات الوصفية
```

---

## 2. الهدف الأساسي للبناء

```bash
make build
```

يطلق:
1. `update_pre_build`
2. `index_all`
3. `speller_all`
4. `update_post_build`

---

## 3. خط أنابيب البناء التفصيلي

### 3.1 مرحلة ما قبل البناء (`update_pre_build`)

#### a. `construct_database`
- ينشئ قاعدة بيانات SQLite (`main.db`) من ملف SQL (`main.sql`).
- يحدث البيانات الوصفية في `information.json`.

#### b. `update_translations_indexed_list`
- يستخدم واجهة سطر الأوامر للاستيراد لإنشاء قائمة بالترجمات المفهرسة.

#### c. `update_dynamic_resources_prebuild`
- يملأ `dynamic_resources/` بقواميس Python المُنشأة تلقائياً لـ:
  - كلمات التوقف
  - المترادفات
  - خصائص الكلمات
  - الاشتقاقات
  - تعيينات العربية إلى الإنجليزية
  - تعيينات القياسي إلى العثماني

---

### 3.2 مرحلة الفهرسة (`index_all`)

#### a. `index_main`
- يبني الفهرس الأساسي (البيانات الوصفية للسورة/الآية).

#### b. `index_extend`
- يبني الفهرس الموسع للترجمات والتلاوات.

#### c. `index_word`
- (اختياري) يبني فهرس مستوى الكلمة للبحث الصرفي.

---

### 3.3 مرحلة التدقيق الإملائي (`speller_all`)

ينشئ قواميس اقتراحات الإملاء لـ:
- نص مستوى الآية (`speller_aya`)
- حقول مستوى الموضوع (`speller_subject`)
- الإملاء على مستوى الكلمة (`speller_word`)

---

### 3.4 مرحلة ما بعد البناء (`update_post_build`)

ينهي الموارد الديناميكية ويحدث البيانات الوصفية.

- `transfer_vocalizations`: ينشئ تعيينات تشكيل الكلمات القرآنية.
- `update_recitations_online_list`: يحمّل التلاوات المحدثة من **EveryAyah**.

---

## 4. مصادر البيانات المستخدمة بواسطة Alfanous

يدمج Alfanous مصادر قرآنية ولغوية خارجية متعددة:

| المصدر | الوصف | الاستخدام |
|---------|-------------|--------|
| [مشروع تنزيل](https://tanzil.net) | نص القرآن في خطوط مختلفة (عثماني، بسيط نظيف) | النص العربي الأساسي للقرآن |
| [موارد Zekr.org](http://zekr.org/resources.html) | ترجمات القرآن | يُستخدم لملء فهارس الترجمة |
| [مدونة القرآن العربية](http://corpus.quran.com) | البيانات الصرفية والنحوية | يبني قاعدة البيانات اللغوية على مستوى الكلمة |
| [EveryAyah.com](http://everyayah.com) | البيانات الوصفية لتلاوات الصوت | إعدادات التلاوات عبر الإنترنت/دون اتصال |
| ملفات SQL الداخلية لـ Alfanous | `main.sql` وملفات البيانات ذات الصلة | قاعدة البيانات المنظمة الأساسية قبل الفهرسة |

تشكل هذه المجموعات العمود الفقري للموارد المفهرسة والقابلة للبحث في Alfanous.

---

## 5. مسؤوليات الملفات والأدلة

| المسار | الوصف |
|------|--------------|
| `src/alfanous-import/cli.py` | مستورد سطر الأوامر لتنزيل الموارد ومعالجتها |
| `resources/databases/main.sql` | مخطط SQL + ملف البيانات للمحتوى القرآني |
| `src/alfanous/resources/` | قوالب الموارد الثابتة وملفات JSON للتكوين |
| `store/translations/` | ملفات XML للترجمة |
| `src/alfanous/dynamic_resources/` | وحدات Python المُنشأة تلقائياً (كلمات التوقف، المترادفات، إلخ.) |
| `src/alfanous/indexes/` | فهارس قابلة للبحث بنمط Lucene |

---

## 6. مثال على تنفيذ البناء

```bash
make build
```

ينفذ السلسلة التالية:

```
construct_database ➜ update_translations_indexed_list ➜ transfer_prebuild ➜ index_main ➜ index_extend ➜ speller_all ➜ transfer_postbuild
```

المخرجات:

- `main.db`
- `indexes/`
- `dynamic_resources/*.py`
- الإعدادات المحدثة (`translations.json`, `information.json`)

---

## 7. التنظيف

```bash
make clean
```
يزيل الملفات المؤقتة والمترجمة وملفات الذاكرة المؤقتة.

---

## 8. الملخص

نظام البناء الخاص بـ Alfanous هو **خط أنابيب هندسة بيانات قوي** يحول الموارد القرآنية واللغوية الأولية إلى هياكل بيانات بحث محسنة ومفهرسة ومدركة للغة تعمل على تشغيل واجهة برمجة التطبيقات وواجهات المستخدم الخاصة بـ Alfanous.
