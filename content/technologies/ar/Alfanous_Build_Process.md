# توثيق نظام البناء لـ Alfanous

يقوم **[نظام بناء Alfanous](./alfanous.md)** بأتمتة عملية إنشاء البيانات اللغوية القرآنية وفهرستها وإعدادها لمحرك البحث. يستخدم النظام أداة **GNU Makefile** لتنسيق عمليات تنزيل الموارد، بناء قاعدة البيانات، توليد الفهارس، والمعالجة اللاحقة عبر نصوص Python البرمجية.

---

## 1. نظرة عامة

يحدد ملف Makefile **مسار عمل (Pipeline)** عالي المستوى لإنتاج البنية التحتية للبيانات الخاصة بـ Alfanous.

```
مصادر القرآن الأولية (XML, SQL dumps)
        │
        ▼
بناء قاعدة البيانات (SQLite)
        │
        ▼
توليد الموارد اللغوية
        │
        ▼
بناء فهارس البحث
        │
        ▼
توليد قواميس التدقيق الإملائي
        │
        ▼
إنهاء الموارد الديناميكية والبيانات الوصفية
```

---

## 2. هدف البناء الأساسي

```bash
make build
```

يقوم هذا الأمر بتشغيل العمليات التالية بالتسلسل:
1. `update_pre_build` (تحديث ما قبل البناء)
2. `index_all` (الفهرسة الشاملة)
3. `speller_all` (التدقيق الإملائي الشامل)
4. `update_post_build` (تحديث ما بعد البناء)

---

## 3. مسار عمل البناء التفصيلي

### 3.1 مرحلة ما قبل البناء (`update_pre_build`)

#### أ. `construct_database`
- إنشاء قاعدة بيانات SQLite باسم (`main.db`) من ملف SQL dump الأساسي (`main.sql`).
- تحديث البيانات الوصفية في ملف `information.json`.

#### ب. `update_translations_indexed_list`
- استخدام واجهة سطر الأوامر (Importer CLI) لتوليد قائمة بالترجمات المفهرسة.

#### ج. `update_dynamic_resources_prebuild`
- ملء مجلد `dynamic_resources/` بقواميس Python المُنشأة تلقائياً لكل من:
  - كلمات التوقف (Stopwords).
  - المترادفات.
  - خصائص الكلمات.
  - الاشتقاقات.
  - **ارتباطات العربية بالإنجليزية (Arabic-to-English mappings).**
  - **ارتباطات الرسم القياسي بالعثماني (Standard-to-Uthmani mappings).**

---

### 3.2 مرحلة الفهرسة (`index_all`)

#### أ. `index_main`
- بناء الفهرس الأساسي (البيانات الوصفية للسور والآيات).

#### ب. `index_extend`
- بناء الفهرس الموسع للترجمات والتلاوات.

#### ج. `index_word`
- (اختياري) بناء فهرس على مستوى الكلمة للبحث الصرفي.

---

### 3.3 مرحلة التدقيق الإملائي (`speller_all`)

توليد قواميس مقترحات التدقيق الإملائي لـ:
- نصوص الآيات (`speller_aya`).
- حقول الموضوعات (`speller_subject`).
- هجاء الكلمات المنفردة (`speller_word`).

---

### 3.4 مرحلة ما بعد البناء (`update_post_build`)

إنهاء الموارد الديناميكية وتحديث البيانات الوصفية.

- `transfer_vocalizations`: توليد ارتباطات تشكيل الكلمات القرآنية.
- `update_recitations_online_list`: تنزيل قائمة التلاوات المحدثة من **EveryAyah**.

---

## 4. مصادر البيانات المستخدمة

يدمج Alfanous مصادر خارجية متعددة للبيانات القرآنية واللغوية:

| المصدر | الوصف | الاستخدام |
|:--- |:--- |:--- |
| [مشروع تنزيل](https://tanzil.net) | نص القرآن بمختلف الرسوم (عثماني، إملائي بسيط) | النص العربي الأساسي للقرآن |
| [موارد Zekr.org](http://zekr.org/resources.html) | ترجمات القرآن | تعبئة فهارس الترجمة |
| [Quranic Arabic Corpus](http://corpus.quran.com) | بيانات صرفية ونحوية | بناء قاعدة البيانات اللغوية لمستوى الكلمات |
| [EveryAyah.com](http://everyayah.com) | البيانات الوصفية للتلاوات الصوتية | إعداد التلاوات المتصلة وغير المتصلة بالإنترنت |
| ملفات SQL الخاصة بـ Alfanous | ملف `main.sql` وملفات البيانات ذات الصلة | قاعدة البيانات المهيكلة الأساسية قبل الفهرسة |

---

## 5. مسؤوليات الملفات والمجلدات

| المسار | الوصف |
|:--- |:--- |
| `src/alfanous-import/cli.py` | واجهة سطر الأوامر لاستيراد الموارد ومعالجتها |
| `resources/databases/main.sql` | مخطط SQL + بيانات محتوى القرآن |
| `src/alfanous/resources/` | قوالب الموارد الثابتة وملفات إعدادات JSON |
| `store/translations/` | ملفات XML الخاصة بالترجمات |
| `src/alfanous/dynamic_resources/` | وحدات Python البرمجية المولدة تلقائياً (المترادفات، إلخ) |
| `src/alfanous/indexes/` | فهارس بحث بأسلوب Lucene |

---

## 6. مثال على تنفيذ البناء

```bash
make build
```

ينفذ هذا الأمر سلسلة العمليات التالية:
```
construct_database ➜ update_translations_indexed_list ➜ transfer_prebuild ➜ index_main ➜ index_extend ➜ speller_all ➜ transfer_postbuild
```
**المخرجات:**
- ملف `main.db`.
- مجلد الفهارس `indexes/`.
- ملفات الموارد الديناميكية `dynamic_resources/*.py`.
- تحديث الإعدادات (`translations.json`, `information.json`).

---

## 7. التنظيف

```bash
make clean
```
يحذف الملفات المؤقتة، الملفات المترجمة (compiled)، وملفات التخزين المؤقت (cache).

---

## 8. ملخص

نظام بناء Alfanous هو **مسار معالجة بيانات (Data Engineering Pipeline)** متين يحول المصادر القرآنية واللغوية الخام إلى هياكل بيانات بحثية محسنة ومفهرسة تدعم واجهات البرمجة والمستخدم الخاصة بـ Alfanous.
